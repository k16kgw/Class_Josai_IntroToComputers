# 様々なフリップフロップ

到達目標
- 各フリップフロップ（Dフリップフロップ・Tフリップフロップ・JKフリップフロップ）の**動作（真理値表）**と**特性方程式**を説明できる．
<!-- - Dフリップフロップ⇄Tフリップフロップ⇄JKフリップフロップの**相互変換**を導ける． -->
<!-- - 簡単な**カウンタ／トグル**などを，D/JK/T を使って設計できる． -->
<!-- - **励起表**（excitation table）を用いて，所望の状態遷移から入力を合成できる． -->

今日の問い
- Dフリップフロップ・Tフリップフロップ・JKフリップフロップの共通点と異なる点は何か？
<!-- - 「トグル」はどのFFで一番作りやすい？ -->
<!-- - 2ビット同期カウンタを D／JK／T それぞれで作ると，式はどう変わる？ -->

キーワード
- 特性方程式（characteristic equation）
<!-- - 励起表（excitation table） -->
<!-- - トグル（toggle），同期カウンタ -->
<!-- - JK の多義入力（J=K=1 でトグル） -->

<!-- ## 第9回の復習

- クロックは**状態確定のものさし**．順序回路は「現在状態+入力」から「次状態・出力」を決める．
- 基本FF（D-FF）で，立上り時に (Q'=D) を保持． -->

---

## Dフリップフロップ

クロックによる同期を導入することで，$D=1$のときに$CLK=1$となればセットし，$D=0$のときに$CLK=1$となればリセットするものとする．

同期付きSRフリップフロップ

![クロックSRフリップフロップ](/contents/figs/9/clockSRflipflop_NAND.png)

を変形し，次のDフリップフロップ回路を構成する．

![Dフリップフロップ](/contents/figs/10/dff_circuit.png)

このDフリップフロップの状態遷移表は次のようになる．

| $CLK$  | $D$    | 現在の状態$Q$ | 次の状態$Q'$ |
| :----: | :----: | :------:    | :-----:     |
|   0    |   ＊   |     0       |    0        |
|   0    |   ＊   |     1       |    1        |
|   1    |   0    |     0       |    0        |
|   1    |   0    |     1       |    0        |
|   1    |   1    |     0       |    1        |
|   1    |   1    |     1       |    1        |

```{note}
**演習1**

上記の状態遷移表からカルノー図を作成し，論理式（**特性方程式**）を導け．


```

---

## Tフリップフロップ

- TはToggleまたはTriggerを意味する．
- ボタンを押すたびに記憶された値が反転する状況を考える．

$T$を入力，$Q$を出力とし，次のタイミングチャートのような挙動を実現する．

![TFFタイミングチャート](/contents/figs/10/tff.png)

状態遷移表は次のようになる．

| 入力$T$ | 現在の状態$Q$ | 次の状態$Q'$      |
| :-:    | :-:          | :-:             |
|  0     |  0           |  0 （状態を維持） |
|  0     |  1           |  1 （状態を維持） |
|  1     |  0           |  1 （状態を反転） |
|  1     |  1           |  0 （状態を反転） |

この状態遷移表を実現するための$Q'$の論理式は次のようになる．

$$
Q' = \overline{T} \cdot Q + T \cdot \overline{Q} = T \oplus Q
$$

これを回路として構成すると次のようになる．ただし$Q$と$Q'$は同じ出力の違うタイミングに過ぎないことに注意する．

![TFF回路](/contents/figs/10/tff_circuit.png)

```{note}
**演習2**

$Q$の初期値を$0$として，入力$T$が`1,0,1,1,0`と変化するときの$Q$の変化を記せ．

<!-- 
$T=1$で反転し，$T=0$で維持するため，入力$T$の直後の$Q$の値は`1,1,0,1,1`となる．
 -->
```

### 弱点

$T=1$となって$Q$の状態の反転が完了したときに，まだ$T=1$のままであれば$Q$の状態の反転が再び起きてしまう．
そのため入力$T$は$Q$の反転が起きる前に即座に終えないといけない．

この弱点を克服するためにSRフリップフロップ回路を組み込んだTフリップフロップ回路を考える．

![SRTFF回路](/contents/figs/10/sr_tff_circuit.png)

この回路のタイミングチャートは次のようになる．

![SRTFFタイミングチャート](/contents/figs/10/sr_tff.png)

---

## JKフリップフロップ

クロックを入力側に加えることで安定な出力を得る．

状態遷移表は次のようになる．

| 入力<br>$J$ | 入力<br>$K$ | 現在の状態$Q$ | 次の状態$Q'$<br>$CLK=0$ | 次の状態$Q'$<br>$CLK=1$ |
| :-:        | :-:         | :-:         | :-:                    | :-:                   |
|  0         |  0          |  0          |  0                     |  0 （状態を維持）       |
|  0         |  0          |  1          |  1                     |  1 （状態を維持）       |
|  0         |  1          |  0          |  0                     |  0 （リセット）         |
|  0         |  1          |  1          |  1                     |  0 （リセット）         |
|  1         |  0          |  0          |  0                     |  1 （セット）           |
|  1         |  0          |  1          |  1                     |  1 （セット）           |
|  1         |  1          |  0          |  0                     |  1 （状態を反転）        |
|  1         |  1          |  1          |  1                     |  0 （状態を反転）        |

```{note}
**演習3**

JKフリップフロップのカルノー図を作成し，簡略化した論理式を求めよ．


```

---
<!-- 
## 4. フリップフロップの相互変換

- **JK → T**：$T = J\oplus K$ ではない点に注意（そのままは不可）
  実用は **$J=K=T$** と置くと **T-FF 動作**（0:保持，1:トグル）を実現できる．
- **JK → D**：
  特性 $Q'=J\overline{Q}+\overline{K}Q$ より，**$D = J\overline{Q}+\overline{K}Q$** を与えれば D-FF 等価動作．
  逆に D 入力から JK を作るなら一例として **$J=D\overline{Q},\ K=\overline{D}Q$**（最小ではないが分かりやすい）．
- **D → T**：
  $Q'=D$ と $Q'=T\oplus Q$ から **$T=D\oplus Q$**．
  → XOR を1個噛ませて D-FF を T 動作に変換できる．
- **T → D**：
  $Q'=T\oplus Q$ から **$D = T\oplus Q$**（同式）．

- 相互変換は所望の$Q'$を各フリップフロップの特性方程式で表し，入力式を解くことで得られる．
 -->


<!-- --- -->
<!-- 
## 5. 例で学ぶ：2ビット**同期**バイナリカウンタ（後半その2：20分）

### 5.1 仕様

- 入力なし，出力は状態 (Q_1Q_0)（00→01→10→11→00…）．
- 立上りトリガ，同期更新．

### 5.2 D-FFで設計

- 目標遷移：
  (Q_0^+ = \overline{Q_0})（毎回反転）
  (Q_1^+ = Q_1\oplus Q_0)（下位が1のとき反転）
- よって
  **(D_0=\overline{Q_0})**，**(D_1=Q_1\oplus Q_0)**

### 5.3 JK-FFで設計

- (Q_0)：毎回トグル → **(J_0=1,\ K_0=1)**
- (Q_1)：(Q_0=1) の時だけトグル → **(J_1=Q_0,\ K_1=Q_0)**

### 5.4 T-FFで設計（最短）

- **(T_0=1)**（常にトグル）
- **(T_1=Q_0)**（下位1のときトグル）

```{tip}
**比較ポイント**
- 回路簡素さ：T-FF ＞ JK-FF ≧ D-FF  
- 実装容易さ：D-FF は合成ツール／FPGAで一般的（汎用性高）．
```
 -->
<!-- --- -->
<!-- 
## よくある用途と注意

- **D-FF**：レジスタ，パイプライン，シリアル入出力など**汎用**．
- **JK-FF**：古典回路・教科書的に頻出（トグルを含む多機能）．現代LSIでは D-FF 優位．
- **T-FF**：**トグル／分周**用途，カウンタ設計の思考モデルに最適．
- **実回路注意**：非同期 CLR/PR の**優先順位**，入力の**グリッチ**，**セットアップ/ホールド**遵守（第9回）．
 -->
<!-- --- -->
<!-- 
## 例題・演習

```{note}
**例題1（励起表）**
- 1ビットの所望遷移：\(Q: 0\to 1\to 1\to 0\to 1\) を  
  1) D-FF，2) JK-FF，3) T-FF で実現する入力波形（クロック毎の値）を求めよ．
```

**解答例（要点）**

- D：(D=Q'\Rightarrow 1,1,0,1)
- JK：励起表より

  - 0→1: (J=1, K=X)
  - 1→1: (J=0, K=0)
  - 1→0: (J=X, K=1)
  - 0→1: (J=1, K=X)
    例：((J,K)=(1,0),(0,0),(0,1),(1,0))
- T：遷移が**変化**のとき1，保持で0 → (1,0,1,1)

```{note}
**例題2（相互変換）**
- JK-FF 1個を **D-FF と同等動作**にしたい．\(J,K\) を \(D\) と \(Q\) で表せ．
```

**解答例**

- (Q'=D) と (Q'=J\overline{Q}+\overline{K}Q) を一致：
  例：(J=D\overline{Q},\ K=\overline{D}Q).（他にも等価割当あり）

```{note}
**演習（小課題）**
1. T-FF 1個で **2分周器**（入力クロックの1/2を出力）を作れ（ブロック図可）．  
2. 3ビット同期カウンタを T-FF で組むときの式を与えよ（\(T_0=?, T_1=?, T_2=?\)）．
```

**解答例**

- 1：T=1 で駆動（常時トグル）→ (Q) が1/2周波数．
- 2：
  (T_0=1)，(T_1=Q_0)，(T_2=Q_1\cdot Q_0)（“下位が全て1の時だけ上位をトグル”）
 -->
<!-- --- -->

## まとめ

- **Dフリップフロップ**：$Q' = D$（最もシンプル）
- **Tフリップフロップ**：$Q' = T \oplus Q$ でトグルを実現
- **JKフリップフロップ**：保持/セット/リセット/トグルを一手に実現
<!-- - 励起表を使えば**所望の遷移→入力**が機械的に求まる． -->
<!-- - カウンタは **T-FF が最短**，実装は D-FF が一般的． -->
<!-- - 次回は **フリップフロップのハザードと同期設計上の注意**（非同期入力の扱い・同期器の再確認）を扱う． -->

<!-- --- -->
<!-- 
### 板書用チートシート

- D：(Q'=D)，励起 (D=Q')
- JK：(Q'=J\overline{Q}+\overline{K}Q)，励起（0→1で (J=1)，1→0で (K=1)）
- T：(Q'=Q\oplus T)，励起（変える=1／保持=0）
- 2ビット同期カウンタ

  - D：(D_0=\overline{Q_0},\ D_1=Q_1\oplus Q_0)
  - JK：(J_0=K_0=1,\ J_1=K_1=Q_0)
  - T：(T_0=1,\ T_1=Q_0)
 -->
