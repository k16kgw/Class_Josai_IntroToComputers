# 揮発性記憶と不揮発性記憶

到達目標
- メモリの種類（ROMとRAM，**揮発性**と**不揮発性**）とその用途の違いを理解する．
<!-- - 記憶の**物理実装**（電荷・磁化・相変化・分極 等）と**安定性・エネルギ**の関係を説明できる． -->
<!-- - 用途に応じて適切な記憶の種類を**設計観点**（遅延・帯域・密度・消費電力・耐久性・コスト）で選定できる． -->

<!-- 今日の問い -->
<!-- - 「電源を切ると消える」か「残る」かは何で決まる？ -->
<!-- - なぜ DRAM は**リフレッシュ**が必要で，SRAM は不要なのか？ -->
<!-- - スマホやPCは**どの記憶**を**どこに**使い分けている？ -->

キーワード
- ROM／RAM
- 揮発性／不揮発性
- フラッシュメモリ
- SRAM／DRAM
<!-- 
- 揮発性／不揮発性，保持（retention），安定性（エネルギ障壁）
- SRAM（6T），DRAM（1T1C，リフレッシュ），ROM，フラッシュ（NAND/NOR）
- 新型不揮発：MRAM／ReRAM／PCM／FeRAM
- レイテンシ，帯域，密度，消費電力，耐久性（書換回数），TCO
 -->

---

## これまでの復習

![概要図](/contents/figs/12/machine.png)

出典「【図解】コンピュータの仕組み・構成と五大装置」https://elite-lane.com/computer/（2025年12月16日閲覧）

- ALU（演算装置）：第6回（加算と減算），第12回（乗算と除算）
- レジスタ：第10回（フリップフロップ），第12回（レジスタ）
- 制御装置：第9回（クロック・同期），第11回（順序回路の設計法）
- 物理実装（トランジスタ）：第8回（NOT・NANDの電気的動作）
- メモリ：第10回（フリップフロップ），第13回（SRAM・DRAM・Flashメモリ）

---

## 記憶とは

- 記憶：ビット = 0/1 の安定な2状態．
- 安定性：2状態間の**エネルギ障壁**が高いほど保持しやすい（ノイズ・漏れ電流に強い）が，書き換えにコストがかかる．
- 物理実装の例（用途に応じて使い分ける）
  - 電荷の有無（**DRAM／フラッシュメモリ**）
  - 回路の再帰（**SRAM／ラッチ／フリップフロップ**）
  - 磁化（**MRAM**）
  - 分極（FeRAM）
  - 相変化（PCM）
  - 導電フィラメント（ReRAM）

---

## メモリの種類

- <span style="color:red">ROM</span> (Read Only Memory)
  - 読み出し専用メモリ
  - データの書き込みは製造時，または特殊な機器で行う．
  - 書き換え回数に制限がある．
  - <span style="color:red">電源を切ってもデータは残る</span>（**不揮発性メモリ**）．
  - 使用例：コンピュータの起動コード，電子辞書のデータ，組み込み機器のソフトウェアなど（SSD／組込みROM）
- <span style="color:red">RAM</span> (Random Access Memory)
  - 任意のアドレスのデータを読み書きできる．
  - <span style="color:red">電源を切るとデータは消える</span>（**揮発性メモリ**）．
  - 電池からの電気の供給でデータを残すものもある．
  - 使用例：演算の作業領域（キャッシュ／主記憶）

### ROMの種類

- MROM (Mask ROM)
- PROM (Programmable ROM)
  - ROM製造後に利用者がカスタマイズ可能
- EPROM (Erasable PROM)
  - 消去可能なPROM
  - データを複数回書き換え可能
  - 強い紫外線を当てるなどしてデータを消去する．
- EEPROM (Electrically Erasable PROM)
  - 電気的に消去可能なPROM
  - 高い電圧をかけることでデータの書き込みや消去を行う．
- <span style="color:red">フラッシュメモリ</span>
  - ブロック単位でデータを一括消去可能なEEPROM
  - ブロック単位で消去と書き込みを行うため動作が遅い．
  - NOR型とNAND型がある．
  - USBメモリ，メモリカード，SSD (Solid State Drive，Macbook airのストレージ)

| NAND型 | NOR型 |
| --- | --- |
| **大容量** | 小容量 |
| アクセスが遅い | **アクセスが速い** |
| 順次アクセス向け | コード格納向け |

<!-- - <span style="color:red">不揮発性</span>（Non-volatile）：電源OFFでも**保持**（例：**ROM／フラッシュ**，MRAM，ReRAM，PCM，FeRAM） -->

### RAMの種類

- DRAM (Dynamic RAM)
  - キャパシタ（大容量のコンデンサ）に電荷を蓄えることでデータを保持する．
  - キャパシタからの電荷の漏れがあるため，定期的に**リフレッシュ**（再充電）する必要がある．
  - データの保持のために回路が動作しているため"Dynamic"と呼ばれる．
- SRAM (Static RAM)
  - 論理回路としてデータを保持する．
  - NOTゲートやフリップフロップの原理に基づきデータを保持する．
  - DRAMより複雑な回路となるため，実装コストが高い．

データの使用頻度によってメモリの種類を使い分ける．

| 使用場所 | 頻度 | メモリの種類 |
| --- | --- | --- |
| CPU | 高頻度 | レジスタ |
| キャッシュメモリ | 中頻度 | SRAM |
| メインメモリ | 低頻度 | DRAM |

### DRAMの仕組み

![仕組み](/contents/figs/13/dram_switch.png)

1bit分のデータを保持する回路は次の通り．

![回路図](/contents/figs/13/dram.png)


### SRAMの仕組み

NOTゲートの回路が基本コンセプト

![NOT](/contents/figs/13/not.png)

1bit分のデータを保持する回路は次の通り．

![回路図](/contents/figs/13/sram_1bit.png)


<!-- 
---

### SRAM（Static RAM）

- **6Tセル**（反転器対＋アクセスMOS）．双安定回路で**常時保持**（ただし電源必須）．
- **特徴**

  - レイテンシ：非常に小（高速），リフレッシュ不要
  - 密度：DRAMより低い（トランジスタ数が多い）
  - 用途：**CPUキャッシュ**，レジスタファイル，オンチップバッファ
 -->
<!-- ---

## 不揮発性メモリのしくみ

### ROM／フラッシュ

- **ROM**：製造時または書換え限定で固定（マスクROM，OTP，EPROM/EEPROM）
- **フラッシュ**（代表：NAND，NOR）

  - **浮遊ゲート**に電荷を蓄える（トンネル効果で書込／消去）
  - **ブロック消去**＋**ページ書込**（細粒度は苦手），**耐久性**（書換回数）に限界
  - **NAND**：高密度・順次アクセス向け（SSD）／**NOR**：ランダム実行・コード格納向け（組込み）

### 新型不揮発（概観）

- **MRAM**（磁化）／**ReRAM**（抵抗変化）／**PCM**（相変化）／**FeRAM**（分極）
  目的：**SRAM/DRAM並の速度**や**高耐久**と**不揮発**の両立（まだ用途最適化の過程）
 -->

---

## 評価指標と使い分け

評価表の軸（○良い，△普通，×弱い：あくまで目安）
<!-- 
| 種別          | 速度(遅延) | 帯域    | 密度 | 消費電力      | 価格/容量 | 書換耐久 | 保持 |
| ----------- | ------ | ----- | -- | --------- | ----- | ---- | -- |
| SRAM        | ○      | ○     | △  | ○（待機×）    | △     | ○    | ×  |
| DRAM        | △      | ○     | ○  | △（リフレッシュ） | ○     | ○    | ×  |
| フラッシュメモリ(NAND) | △〜×    | ○（順次） | ◎  | ○（待機◎）    | ◎     | △    | ○  |
| MRAM等       | ○      | ○     | △  | ○         | △     | ○    | ○  |
 -->

| 種別          | 速度(遅延)   | 密度 | 消費電力      | 価格/容量 | 書換耐久 | 保持 |
| ----------- | ------       | -- | --------- | ----- | ---- | -- |
| SRAM        | ○            | △  | ○（待機×）    | △     | ○    | ×  |
| DRAM        | △            | ○  | △（リフレッシュ） | ○     | ○    | ×  |
| フラッシュメモリ(NAND) | △〜× | ◎  | ○（待機◎）    | ◎     | △    | ○  |
| MRAM等       | ○           | △  | ○         | △     | ○    | ○  |

<!-- - 層構造で使い分ける：レジスタ／L1-L3（SRAM）→ 主記憶（DRAM）→ 永続（フラッシュメモリ／SSD） -->
<!-- - **SoC/組込み**：ブートROM＋内蔵SRAM＋外付DRAM＋外付フラッシュが定番 -->

<!-- - 「センサを常時監視し，電池で数年動かしたい」用途で，SRAM/DRAM/フラッシュ の組み合わせ案を2通り提案し，理由を1行ずつ． -->

<!-- 
## 例題・演習

**例題A（分類）**
次の用途に最適な記憶方式を選び，理由を1行で述べよ．

1. CPUのL1キャッシュ  2) ノートPCの主記憶  3) スマホのアプリ保存  4) マイコンのブートコード

**例題B（SRAM vs DRAM）**

1. なぜSRAMはリフレッシュ不要で，DRAMは必要か．
2. 同じ容量で面積が小さいのはどちらか，理由は？

**演習1（小設計）｜超小型データロガー**

- 条件：10分に1回 32バイトを10年保存，普段はスリープ．
- 設計：センサ→バッファ（SRAM?）→書込（フラッシュ?）の流れをブロック図化．
- どの瞬間にどの記憶を使い，なぜその方式が有利かを箇条書きで．

**演習2（思考）｜主記憶が不揮発だったら？**

- 起動高速化・電力・寿命・セキュリティの観点で，利点と課題を3行ずつ．

---
 -->

## まとめ

- ROM（**不揮発性メモリ**）：保持・保存向け（ROM/フラッシュ 他）．
- RAM（**揮発性メモリ**）：高速・演算向け（SRAM/DRAM）
- 物理実装の差（電荷・磁化・相変化など）が記憶の**保持・速度・耐久・密度**を決める．
<!-- - システムは**階層化**で最適化する：レジスタ/キャッシュ→主記憶→外部記憶． -->
