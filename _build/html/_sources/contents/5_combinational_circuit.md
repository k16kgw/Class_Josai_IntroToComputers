# クワイン・マクラスキー法による組合せ回路の設計法

到達目標
<!-- 
- 組合せ回路の設計法としての**クワイン・マクラスキー（Q–M）法**を理解し，主加法標準形から**最小SOP**を系統的に導出できる．
- **Q–M法**で主加法標準形から**最小SOP**を機械的に求められる。
- **don’t care（ドントケア）**の意味を説明し、最小化に正しく活用できる。
- **ペトリック法**で残りカバーの最小集合を選べる。
- 最小SOPを**NAND–NAND**で実装できる。
 -->
今日の問い

- カルノー図では煩雑な場合に，どのように系統的に論理式を簡略化できるか？
- 論理式の簡略化においてドントケアはどのような役割を果たすか？
<!-- - ペトリック法はどんな“代数”で何を最小化している？ -->

キーワード

- クワイン・マクラスキー法（Quine--McCluskey algorithm，Q--M法）
- ドントケア（don’t care）
- ペトリック法（Petrick’s method）

## 復習（第4回）

論理式が与えられたときに，これを簡略化してNAND回路を構成するまでの一連の手続き
1. （乗法標準形の場合）分配則を用いて加法標準形に変換する．
2. **主加法標準形** に変換する．
3. 各最小項に対応する区画に1を入れ， **カルノー図** を作成する．
4. 1の区画をなるべく大きい **グループで区分け** する．
   - グループは含む区画の数が **2の冪（1,2,4,8,16）** となるような，長方形または正方形をした区画のまとまり
5. グループの大きさを順に小さくし，区分けされなかった区画を含むようにグループによる区分けを行う．ただし，区画は複数のグループに属しても良い．
6. 得られたグループを表す論理式の和として元の論理式の簡略化を得る．
7. 簡略化した論理式に **2重否定** を施し，内側の否定について **ド・モルガンの法則** を適用する．
8. NAND回路に実装する．

グレイコード（隣接する符号間のハミング距離は1）を使う理由
- 隣接セルが常に1ビット差になるように並ぶため，カルノー図でグループを作成した場合にグループが簡略化された論理式になる．

```{tip}
**例**

主加法標準形で表された次の論理式$F$のカルノー図を作成する．

$$
F = \overline{A} \cdot B \cdot C
 + A \cdot B \cdot \overline{C}
 + \overline{A} \cdot B \cdot \overline{C}
 + A \cdot B \cdot C 
 + A \cdot \overline{B} \cdot C
$$

カルノー図は次の通り．

![例0](/contents/figs/4/eg2.png)

列の2進数の順をグレイコード配列でないものにした場合．

![例0-1](/contents/figs/5/eg_old.png)
```

## クワイン・マクラスキー法

カルノー図の欠点
- 入力数が5つ程度までにしか適用できない．（図表が大きくなりすぎるため）
- アルゴリズム化できない．（コンピュータプログラムとして実装できない）

手続き

**I. 圧縮表の作成（主項の導出）**
1. 与えられた論理式を主加法標準形に変換する．
2. 否定でない変数を1，否定された変数を0として，最小項を2進数で表記する．
3. **1の個数**ごとに最小項をグループ分けする．
4. 隣接グループ同士で**1ビットだけ異なる**組を結合し，異なる桁を **“–”** で表す（ダッシュ表記）．（**圧縮**）
5. 結合した要素について同様に結合し，これ以上結合できなくなるまで繰り返す．
6. これ以上結合できなくなった項を<span style="color:red">主項</span>と呼ぶ．

**II. 主項表の作成**
1. 行を主項，列をIで求めた最小項とする表を作成する．
2. 主項が最小項を包含している要素に **⚪︎印** をつける．
3. 各最小項の列で⚪︎印が一つしかない場合，その⚪︎印を **◎印** に書き換える．◎印のついた主項を<span style="color:red">必須項</span>と呼ぶ．
4. ◎印のついた主項の行の⚪︎印を全て◎印に書き換える．
5. ⚪︎印しかない主項を省くことで簡略化された論理式を得る．

```{tip}
**例**

次の真理値表で表される論理式$F$の簡略化された論理式をクワイン・マクラスキー法を用いて導出する．

| A | B | C | $F(A,B,C)$ |
|:-:|:-:|:-:|:-:|
| 0 | 0 | 0 | 0 |
| 0 | 0 | 1 | 0 |
| 0 | 1 | 0 | 1 |
| 0 | 1 | 1 | 1 |
| 1 | 0 | 0 | 0 |
| 1 | 0 | 1 | 1 |
| 1 | 1 | 0 | 1 |
| 1 | 1 | 1 | 1 |

圧縮表は

![例1](/contents/figs/5/eg1-1.png)

主項表は

![例1](/contents/figs/5/eg1-2.png)

従って$F(A,B,C) = A \cdot C + B$．
```

```{note}
**演習1**

次の真理値表で定義される論理式$G$の簡略化された論理式をクワイン・マクラスキー法を用いて導出せよ．

| A | B | C | D | $G(A,B,C,D)$ |
|:-:|:-:|:-:|:-:|:-:|
| 0 | 0 | 0 | 0 | 0 |
| 0 | 0 | 0 | 1 | 0 |
| 0 | 0 | 1 | 0 | 0 |
| 0 | 0 | 1 | 1 | 0 |
| 0 | 1 | 0 | 0 | 0 |
| 0 | 1 | 0 | 1 | 1 |
| 0 | 1 | 1 | 0 | 1 |
| 0 | 1 | 1 | 1 | 1 |
| 1 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 1 | 0 |
| 1 | 0 | 1 | 0 | 0 |
| 1 | 0 | 1 | 1 | 0 |
| 1 | 1 | 0 | 0 | 0 |
| 1 | 1 | 0 | 1 | 1 |
| 1 | 1 | 1 | 0 | 1 |
| 1 | 1 | 1 | 1 | 1 |
<!-- 
圧縮表は

![演習1](/contents/figs/5/exc1-1.png)

主項表は

![演習1](/contents/figs/5/exc1-2.png)

従って$G(A,B,C,D) = B \cdot C + B \cdot D$．
 -->
```

## ドントケア

- **物理的に生じない**，または **出力が0, 1のどちらでも構わない** 項をドントケアと呼ぶ．
- ドントケアの項は1として扱うことが可能である．ただし**必要なときだけ**使用し、不要なら 0 と同様に扱う．
- ドントケアの出力は`*`で表す．

利点
- カルノー図やクワイン・マクラスキー法で **大きいグループ（2,4,8セル）** が作れるようになり，**項数** を減らせる．

### ドントケアを含む場合のカルノー図

```{tip}
**例**

次の真理値表で表される論理式$F'$のカルノー図を作成する．

| A | B | C | $F'(A,B,C)$ |
|:-:|:-:|:-:|:-:|
| 0 | 0 | 0 | 0 |
| 0 | 0 | 1 | 0 |
| 0 | 1 | 0 | 1 |
| 0 | 1 | 1 | 1 |
| 1 | 0 | 0 | ＊ |
| 1 | 0 | 1 | 1 |
| 1 | 1 | 0 | 1 |
| 1 | 1 | 1 | 1 |

![例2](/contents/figs/5/eg2-1.png)

ドントケアを1と見做してグループの区画分けを行うと，

![例2](/contents/figs/5/eg2-2.png)
```

```{note}
**演習2**

次の真理値表で定義される論理式$G'$のカルノー図を作成し，簡略化された論理式を得よ．

| A | B | C | D | $G'(A,B,C,D)$ |
|:-:|:-:|:-:|:-:|:-:|
| 0 | 0 | 0 | 0 | 0 |
| 0 | 0 | 0 | 1 | 0 |
| 0 | 0 | 1 | 0 | 0 |
| 0 | 0 | 1 | 1 | 1 |
| 0 | 1 | 0 | 0 | ＊ |
| 0 | 1 | 0 | 1 | 1 |
| 0 | 1 | 1 | 0 | 1 |
| 0 | 1 | 1 | 1 | 1 |
| 1 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 1 | 0 |
| 1 | 0 | 1 | 0 | ＊ |
| 1 | 0 | 1 | 1 | 0 |
| 1 | 1 | 0 | 0 | ＊ |
| 1 | 1 | 0 | 1 | 1 |
| 1 | 1 | 1 | 0 | 1 |
| 1 | 1 | 1 | 1 | 1 |
<!-- 
カルノー図は次のように区分けできる．

![演習2](/contents/figs/5/exc2-1.png)

ここでグループによる区画分けを行うと，

![演習2](/contents/figs/5/exc2-2.png)

従って，$G' = B + \overline{A} \cdot C \cdot D$となる．
 -->
```

### ドントケアを含む場合のクワイン・マクラスキー法

- 手順は通常のクワイン・マクラスキー法と同じ．
- ドントケアは結合候補に**含めてよい**．

```{tip}
**例**

次の真理値表で表される論理式$F'$の簡略化された論理式をクワイン・マクラスキー法を用いて導出する．

| A | B | C | $F'(A,B,C)$ |
|:-:|:-:|:-:|:-:|
| 0 | 0 | 0 | 0 |
| 0 | 0 | 1 | 0 |
| 0 | 1 | 0 | 1 |
| 0 | 1 | 1 | 1 |
| 1 | 0 | 0 | ＊ |
| 1 | 0 | 1 | 1 |
| 1 | 1 | 0 | 1 |
| 1 | 1 | 1 | 1 |

圧縮表は

![例1](/contents/figs/5/eg3-1.png)

主項表は

![例1](/contents/figs/5/eg3-2.png)

従って$F'(A,B,C) = A + B$．
```

```{note}
**演習3**

次の真理値表で定義される論理式$G'$の簡略化された論理式をクワイン・マクラスキー法を用いて導出せよ．

| A | B | C | D | $G'(A,B,C,D)$ |
|:-:|:-:|:-:|:-:|:-:|
| 0 | 0 | 0 | 0 | 0 |
| 0 | 0 | 0 | 1 | 0 |
| 0 | 0 | 1 | 0 | 0 |
| 0 | 0 | 1 | 1 | 1 |
| 0 | 1 | 0 | 0 | ＊ |
| 0 | 1 | 0 | 1 | 1 |
| 0 | 1 | 1 | 0 | 1 |
| 0 | 1 | 1 | 1 | 1 |
| 1 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 1 | 0 |
| 1 | 0 | 1 | 0 | ＊ |
| 1 | 0 | 1 | 1 | 0 |
| 1 | 1 | 0 | 0 | ＊ |
| 1 | 1 | 0 | 1 | 1 |
| 1 | 1 | 1 | 0 | 1 |
| 1 | 1 | 1 | 1 | 1 |
```

<!-- 
## ペトリック法（最小被覆の代数）

- 各ミン項列 j について、その列を覆う PI の“和” (S_j) を作る（例：(S_j=P_1+P_3)）。
- 全体の条件は (\prod_j S_j)（**和の積**）として表せる。
- 分配と吸収で簡約し、**項数最小**（ついでに**リテラル数**も少ない）な PI 組を選ぶ。

```{note}
**ミニ演習（10分）**
- 3列×4行の小さなカバレッジ表を配布。\(S_1,S_2,S_3\) を書き、\(S_1S_2S_3\) を展開→吸収で最小集合を決めよ。途中式を明記。
```
 -->
<!-- 
## 5. NAND回路としての実装

- **SOP → NAND–NAND** が直結。インバータは (\operatorname{NAND}(X,X)) で実現し**共有**する。
- 例：(F=A + C\overline{D}) を NAND 化

$$
F = A + C\overline{D}
= \overline{\overline{A} \cdot \overline{C\overline{D}}}
= \overline{\overline{A} \cdot \overline{\overline{\overline{C}} + D}}
$$

- 実装スケッチ

  - 反転を一度だけ生成：(\overline{A},\overline{C},\overline{D})
  - (C\overline{D}) を NAND で作成（内部 NOT を活用）
  - 最終段 NAND で ORを実現
- **注意**：ハザードが問題となる場所では、**合意項**を追加しても**定常論理は変わらない**（静的1ハザード対策）。

```{tip}
**手を動かす4（7分）**
- \(F=\overline{B}C + B\overline{C}\) を 2入力NANDのみで実装せよ（最短3ゲート）。段数・ゲート数を数える。
```
 -->
<!-- 
## 6. よくある落とし穴

- 2ビット以上違う項を結合してしまう（ダッシュ位置の誤り）。
- 結合済みの minterm を PI に残す。
- EPI を取り切らずにペトリック法へ進む。
- don’t care を常に 1 と誤解（**必要なときだけ 1 扱い**）。
 -->

## まとめ

- クワイン・マクラスキー法の手続き
    1. 圧縮表を作成する．
    2. 主項表を作成する．
- ドントケア：0,1のどちらでも良い項を用いて，より簡略化することが可能になる．

<!-- 
## 2. 例1（ウォームアップ：3変数）

**仕様**：(F(A,B,C)=\sum m(1,2,5,6))，(d=\varnothing)

- グループ分け（1の個数）

  - 1個：(001(m_1),010(m_2))
  - 2個：(101(m_5),110(m_6))
- 第1結合

  - (001)–(101) → (-01)（Aがダッシュ）
  - (010)–(110) → (-10)（Aがダッシュ）
- これ以上結合不可 → **PI**：(-01=\overline{B}C)，(-10=B\overline{C})
- カバレッジ表でどちらも**EPI** → 最小SOP：

  - (\boxed{F=\overline{B}C+B\overline{C}})（= XOR）

```{tip}
**手を動かす1（5分）**
- 上の表を自分のノートに作り，使用済チェック（✓）と PI を明示せよ．
```

---

## 3. 例2（本格：4変数＋don’t care）

**仕様**：(F(A,B,C,D)=\sum m(1,3,7,9,11,15))，(d=\sum m(0,2,8,10))

- グループ分け

  - 1個：(0001)
  - 2個：(0011,1001) ＋ (d:0010,1000)
  - 3個：(0111,1011,1111) ＋ (d:1010)
  - 0個：(d:0000)
- 結合ラウンド1（例）

  - (0001)–(0011)→(00-1)，(0001)–(1001)→(-001)
  - (0011)–(0111)→(0-11)，(1001)–(1011)→(10-1)
  - (0111)–(1111)→(-111)，(1011)–(1111)→(1-11)
  - don’t care との結合例：(0000)–(0001)→(000-) ほか
- 結合ラウンド2（例）

  - (00-1)–(10-1)→(-0-1)
  - (0-11)–(1-11)→(--11)
  - (-001)–(000-)→(0-0-)
- PI 候補（簡約表現の例）

  - (-0-1=\overline{B}D)，(--11=CD)，(0-0-=\overline{A},\overline{C}) など
- カバレッジ表→EPI を先に選択，残りを目視 or ペトリック法で決定
- 一例としての最小SOP：(\boxed{F= A + C\overline{D}})（同価解が複数あり得る）

```{tip}
**手を動かす2（12分）**
- 上記仕様で自分たちの結合列を作り，PI を列挙→カバレッジ表→最小SOP。班ごとに“違うけど等価”な解を持ってきてOK。
``` 
-->
