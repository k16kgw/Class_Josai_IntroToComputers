# 揮発性記憶と不揮発性記憶

到達目標
- **揮発性**と**不揮発性**の定義を説明し，代表的素子（**SRAM／DRAM／ROM／フラッシュ**ほか）の**動作原理・特徴**を述べられる．
- 記憶の**物理実装**（電荷・磁化・相変化・分極 等）と**安定性・エネルギ**の関係を説明できる．
- 用途に応じて適切な記憶の種類を**設計観点**（遅延・帯域・密度・消費電力・耐久性・コスト）で選定できる．

今日の問い

- 「電源を切ると消える」か「残る」かは何で決まる？
- なぜ DRAM は**リフレッシュ**が必要で，SRAM は不要なのか？
- スマホやPCは**どの記憶**を**どこに**使い分けている？

キーワード

- 揮発性／不揮発性，保持（retention），安定性（エネルギ障壁）
- SRAM（6T），DRAM（1T1C，リフレッシュ），ROM，フラッシュ（NAND/NOR）
- 新型不揮発：MRAM／ReRAM／PCM／FeRAM
- レイテンシ，帯域，密度，消費電力，耐久性（書換回数），TCO

---

## 復習

- 第9〜12回のつながり：FFやレジスタは**記憶**の基本素片（揮発）→ そこから主記憶・外部記憶へ拡張．
- D-FFが“記憶できる”のはなぜ？電源OFF後はどうなる？

---

## 記憶とは何か：抽象から物理へ

- **抽象**：ビット = 0/1 の**安定な2状態**．
- **物理実装の原理**（例）

  - 電荷の有無（**DRAM，フラッシュ**）
  - 回路の再帰（**SRAM／ラッチ／FF**）
  - 磁化（**MRAM**），分極（**FeRAM**），相変化（**PCM**），導電フィラメント（**ReRAM**）
- **安定性の直観**：2状態間の**エネルギ障壁**が高いほど**保持**しやすい（ノイズ・漏れ電流に強い）が，**書き換え**にコストがかかる傾向．

- 「0/1 を何の物理量で持っているか」を4例挙げ，長所・短所を1語ずつ書く（電荷＝高速／漏れ 等）．

---

## 揮発性 vs 不揮発性（定義と代表例）

- **揮発性（Volatile）**：電源供給が止まると**情報消失**（例：レジスタ，**SRAM**，**DRAM**）
- **不揮発性（Non-volatile）**：電源OFFでも**保持**（例：**ROM／フラッシュ**，MRAM，ReRAM，PCM，FeRAM）

用途の大枠

- **揮発性**：演算の作業領域（**キャッシュ／主記憶**）
- **不揮発性**：起動コード・プログラム・データの**長期保存**（SSD／組込みROM）

---

## 揮発性メモリのしくみ

### SRAM（Static RAM）

- **6Tセル**（反転器対＋アクセスMOS）．双安定回路で**常時保持**（ただし電源必須）．
- **特徴**

  - レイテンシ：非常に小（高速），リフレッシュ不要
  - 密度：DRAMより低い（トランジスタ数が多い）
  - 用途：**CPUキャッシュ**，レジスタファイル，オンチップバッファ

### DRAM（Dynamic RAM）

- **1T1Cセル**（アクセスMOS＋キャパシタ）．**電荷の有無**でビットを表現．
- **なぜリフレッシュ？** キャパシタの電荷は**漏れ**で減る → **一定周期で再充電**が必要
- **特徴**

  - レイテンシ：SRAMより大きい（行アクティベーション→列アクセス）
  - 密度：高い（安価に大容量）
  - 用途：**主記憶（メインメモリ）**

- キャパシタに入れた電荷がゆっくり減るイメージを図示．
- 「読み出しが破壊的（read-disturb）」になる理由を説明：読み出しで電荷が動く→**再書込み**が必要．

---

## 不揮発性メモリのしくみ

### ROM／フラッシュ

- **ROM**：製造時または書換え限定で固定（マスクROM，OTP，EPROM/EEPROM）
- **フラッシュ**（代表：NAND，NOR）

  - **浮遊ゲート**に電荷を蓄える（トンネル効果で書込／消去）
  - **ブロック消去**＋**ページ書込**（細粒度は苦手），**耐久性**（書換回数）に限界
  - **NAND**：高密度・順次アクセス向け（SSD）／**NOR**：ランダム実行・コード格納向け（組込み）

### 新型不揮発（概観）

- **MRAM**（磁化）／**ReRAM**（抵抗変化）／**PCM**（相変化）／**FeRAM**（分極）
  目的：**SRAM/DRAM並の速度**や**高耐久**と**不揮発**の両立（まだ用途最適化の過程）

---

## 設計者の視点：評価指標と使い分け

評価表の軸（○良い，△普通，×弱い：学習目的の目安）

| 種別          | 速度(遅延) | 帯域    | 密度 | 消費電力      | 価格/容量 | 書換耐久 | 保持 |
| ----------- | ------ | ----- | -- | --------- | ----- | ---- | -- |
| SRAM        | ○      | ○     | △  | ○（待機×）    | △     | ○    | ×  |
| DRAM        | △      | ○     | ○  | △（リフレッシュ） | ○     | ○    | ×  |
| フラッシュ(NAND) | △〜×    | ○（順次） | ◎  | ○（待機◎）    | ◎     | △    | ○  |
| MRAM等       | ○      | ○     | △  | ○         | △     | ○    | ○  |

- **層構造で使い分け**：

  - レジスタ／L1-L3（SRAM）→ 主記憶（DRAM）→ 永続（フラッシュ/SSD）
- **SoC/組込み**：ブートROM＋内蔵SRAM＋外付DRAM＋外付フラッシュが定番

<!-- - 「センサを常時監視し，電池で数年動かしたい」用途で，SRAM/DRAM/フラッシュ の組み合わせ案を2通り提案し，理由を1行ずつ． -->

---

## 具体例：セルとタイミング（後半その1：10分）

- **SRAM 6T**：交差結合インバータ（保持）＋2アクセスMOS（読み書き）
- **DRAM 1T1C**：ビット線，ワード線，選択MOS，容量C
- **フラッシュ**：浮遊ゲートMOS，しきい値電圧の違いで 0/1（多値も可能）

タイミングの直観

- SRAM 読み出し：選択→ビット線差電圧→センス
- DRAM 読み出し：行アクティベート（全行の電荷をビット線へ）→センス→**リストア**→列選択
- フラッシュ 書込／消去：高電界トンネル→**遅いが保持は長い**

---

## よくある設計課題

- **DRAMリフレッシュの負担**：一定周期で全セル巡回 → 帯域の一部を消費
- **消費電力**：SRAMは待機リーク，DRAMはリフレッシュ電力，フラッシュは書込ピークが大きいが待機極小
- **耐久性**：フラッシュは書換寿命あり → **ウェアレベリング／ECC** が必須
- **セキュリティ**：不揮発は残留情報 → **暗号化／消去** の手当て

---
<!-- 
## 例題・演習

**例題A（分類）**
次の用途に最適な記憶方式を選び，理由を1行で述べよ．

1. CPUのL1キャッシュ  2) ノートPCの主記憶  3) スマホのアプリ保存  4) マイコンのブートコード

**例題B（SRAM vs DRAM）**

1. なぜSRAMはリフレッシュ不要で，DRAMは必要か．
2. 同じ容量で面積が小さいのはどちらか，理由は？

**演習1（小設計）｜超小型データロガー**

- 条件：10分に1回 32バイトを10年保存，普段はスリープ．
- 設計：センサ→バッファ（SRAM?）→書込（フラッシュ?）の流れをブロック図化．
- どの瞬間にどの記憶を使い，なぜその方式が有利かを箇条書きで．

**演習2（思考）｜主記憶が不揮発だったら？**

- 起動高速化・電力・寿命・セキュリティの観点で，利点と課題を3行ずつ．

---
 -->

## まとめ

- **揮発性**：高速・演算向け（SRAM/DRAM）／**不揮発性**：保持・保存向け（ROM/フラッシュ 他）．
- 物理実装の差（電荷・磁化・相変化…）が**保持・速度・耐久・密度**を決める．
- システムは**階層化**で最適化する：レジスタ/キャッシュ→主記憶→外部記憶．
